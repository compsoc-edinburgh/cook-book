function delay(e,t){let n=0;return function(){let s=this,o=arguments;clearTimeout(n),n=setTimeout(function(){e.apply(s,o)},t||0)}}function escape(e){return e.replace(/[^0-9A-Za-z ]/g,e=>"&#"+e.charCodeAt(0)+";")}function replaceQueryParam(e,t,n){let o=new RegExp("([?;&])"+e+"[^&;]*[;&]?"),s=n.replace(o,"$1").replace(/&$/,"");return(s.length>2?s+"&":"?")+(t?e+"="+t:"")}function getFiltersFromDOM(){let e={q:"",excludeAllergens:[],includeTaxonomies:{}};e.q=document.getElementById("search-query").value.trim();let t=document.getElementsByClassName("filter-checkbox");for(let n=0;n<t.length;n++){let s=t[n].getAttribute("data-filter-key"),o=t[n].getAttribute("data-filter-value");if(t[n].checked){if(s==="allergens"){e.excludeAllergens.push(o);continue}e.includeTaxonomies[s]=e.includeTaxonomies[s]||[],e.includeTaxonomies[s].push(o)}}return e}function setFiltersToDOM(e){document.getElementById("search-query").value=e.q;let t=document.getElementsByClassName("filter-checkbox");for(let e=0;e<t.length;e++)t[e].checked=!1;for(let t=0;t<e.excludeAllergens.length;t++){let s="[data-filter-key=allergens]",o='[data-filter-value="'+e.excludeAllergens[t]+'"]',n=document.querySelectorAll(s+o);for(let e=0;e<n.length;e++)n[e].checked=!0}for(let t in e.includeTaxonomies)for(let n=0;n<e.includeTaxonomies[t].length;n++){let o="[data-filter-key="+t+"]",i='[data-filter-value="'+e.includeTaxonomies[t][n]+'"]',s=document.querySelectorAll(o+i);for(let e=0;e<s.length;e++)s[e].checked=!0}}function decodeFiltersFromURL(e){let t={q:"",excludeAllergens:[],includeTaxonomies:{}},n=new URL(e).searchParams;for(let[e,s]of n.entries())e=="q"?t.q=s:e=="allergens"?t.excludeAllergens.push(...s.split(",")):(t.includeTaxonomies[e]=t.includeTaxonomies[e]||[],t.includeTaxonomies[e].push(...s.split(",")));return t}function encodeFiltersToURL(e){let t="";t=replaceQueryParam("q",e.q,t),t=replaceQueryParam("allergens",e.excludeAllergens.join(","),t);for(let n in e.includeTaxonomies)t=replaceQueryParam(n,e.includeTaxonomies[n].join(","),t);return t}function existsInRecipe(e,t){return function(n){return!!e.params[t]&&(!!(Array.isArray(e.params[t])&&e.params[t].includes(n))||e.params[t]===n)}}function negate(e){return function(...t){return!e(...t)}}function scoreMultiWordSearch(e,t){if(t.includes(e))return 0;let n=e.indexOf(" ");if(n>-1)for(;n>-1;){if(before=e.slice(0,n),after=e.slice(n+1,e.length),score1=scoreMultiWordSearch(before,t)-100,score2=scoreMultiWordSearch(after,t)-100,score1!=-(1/0)||score2!=-(1/0))return Math.max(score1,score2);n=e.indexOf(" ",n+1)}return-(1/0)}function filterRecipes(e,t){let n=e;t.q&&(n=e.map(e=>{let s=scoreMultiWordSearch(t.q.toLowerCase(),e.title.toLowerCase()),o=scoreMultiWordSearch(t.q.toLowerCase(),e.body.toLowerCase()),n={...e};if(s>-(1/0))n.searchScore=s;else if(o>-(1/0)){let e=5;n.searchScore=(o-100)*e}return n}).sort((e,t)=>e.searchScore<=t.searchScore?1:-1).filter(e=>e.searchScore>-(1/0)));let s=[];for(let e=0;e<n.length;e++){let o=n[e];if(t.excludeAllergens.some(existsInRecipe(o,"allergens")))continue;if(Object.keys(t.includeTaxonomies).some(e=>t.includeTaxonomies[e].every(negate(existsInRecipe(o,e)))))continue;s.push(o)}return s}function updateRecipeDOM(e){let t="";for(const o in e){let n=e[o],i="."+n.relPermalink,s=n.params.previewimage;t+='<li class="recipe-listing-item col"><a href=".'+i+'"><div class="card h-100 '+(s?"card-image":"")+'" role="article">'+(s?'<img loading="card-img-top lazy" src="'+(s.substr(0,4)=="http"?"":n.relPermalink)+s+'" class="card-image-top mx-1 mt-1" alt="Delicious-looking image of '+escape(n.title)+'" />':"")+'<div class="card-body'+(s?" card-img-overlay":"")+'"><span class="meta">'+escape(n.params.meals)+"/"+escape(n.params.difficulties)+'</span><h4 class="display-5 mt-lg-3">'+escape(n.title)+"</h4></div></div></a></li>"}document.getElementById("recipe-listing").innerHTML=t}function onLoad(){let e=decodeFiltersFromURL(document.location);setFiltersToDOM(e),fetch("index.json").then(e=>e.json()).then(t=>{window.recipesData=t;let n=filterRecipes(window.recipesData||[],e);updateRecipeDOM(n),document.getElementById("page-title").innerHTML="Recipes"})}document.addEventListener("DOMContentLoaded",onLoad),document.readyState!=="loading"&&onLoad(),document.getElementById("search-query").addEventListener("input",delay(()=>{let e=getFiltersFromDOM();updateRecipeDOM(filterRecipes(window.recipesData||[],e)),history.pushState(e,document.title,encodeFiltersToURL(e))},400));const checkboxes=document.getElementsByClassName("filter-checkbox");for(let e=0;e<checkboxes.length;e++)checkboxes[e].addEventListener("change",()=>{let e=getFiltersFromDOM();updateRecipeDOM(filterRecipes(window.recipesData||[],e)),history.pushState(e,document.title,encodeFiltersToURL(e))});window.addEventListener("popstate",e=>{let t=e.state;e.state||(t={q:"",excludeAllergens:[],includeTaxonomies:{}}),setFiltersToDOM(t);let n=filterRecipes(window.recipesData||[],t);updateRecipeDOM(n)})