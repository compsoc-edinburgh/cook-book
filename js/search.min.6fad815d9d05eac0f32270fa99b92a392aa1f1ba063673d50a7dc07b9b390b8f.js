function delay(b,c){let a=0;return function(){let d=this,e=arguments;clearTimeout(a),a=setTimeout(function(){b.apply(d,e)},c||0)}}function escape(a){return a.replace(/[^0-9A-Za-z ]/g,a=>"&#"+a.charCodeAt(0)+";")}function replaceQueryParam(a,b,d){let e=new RegExp("([?;&])"+a+"[^&;]*[;&]?"),c=d.replace(e,"$1").replace(/&$/,'');return(c.length>2?c+"&":"?")+(b?a+"="+b:'')}function getFiltersFromDOM(){let a={q:"",excludeAllergens:[],includeTaxonomies:{}};a.q=document.getElementById("search-query").value.trim();let b=document.getElementsByClassName("filter-checkbox");for(let c=0;c<b.length;c++){let d=b[c].getAttribute("data-filter-key"),e=b[c].getAttribute("data-filter-value");if(b[c].checked){if(d==="allergens"){a.excludeAllergens.push(e);continue}a.includeTaxonomies[d]=a.includeTaxonomies[d]||[],a.includeTaxonomies[d].push(e)}}return a}function setFiltersToDOM(a){document.getElementById("search-query").value=a.q;let b=document.getElementsByClassName("filter-checkbox");for(let a=0;a<b.length;a++)b[a].checked=!1;for(let b=0;b<a.excludeAllergens.length;b++){let d="[data-filter-key=allergens]",e='[data-filter-value="'+a.excludeAllergens[b]+'"]',c=document.querySelectorAll(d+e);for(let a=0;a<c.length;a++)c[a].checked=!0}for(let b in a.includeTaxonomies)for(let c=0;c<a.includeTaxonomies[b].length;c++){let e="[data-filter-key="+b+"]",f='[data-filter-value="'+a.includeTaxonomies[b][c]+'"]',d=document.querySelectorAll(e+f);for(let a=0;a<d.length;a++)d[a].checked=!0}}function decodeFiltersFromURL(b){let a={q:"",excludeAllergens:[],includeTaxonomies:{}},c=new URL(b).searchParams;for(let[b,d]of c.entries())b=="q"?a.q=d:b=="allergens"?a.excludeAllergens.push(...d.split(",")):(a.includeTaxonomies[b]=a.includeTaxonomies[b]||[],a.includeTaxonomies[b].push(...d.split(",")));return a}function encodeFiltersToURL(b){let a="";a=replaceQueryParam("q",b.q,a),a=replaceQueryParam("allergens",b.excludeAllergens.join(","),a);for(let c in b.includeTaxonomies)a=replaceQueryParam(c,b.includeTaxonomies[c].join(","),a);return a}function existsInRecipe(a,b){return function(c){return!!a.params[b]&&(!!(Array.isArray(a.params[b])&&a.params[b].includes(c))||(a.params[b]===c))}}function negate(a){return function(...b){return!a(...b)}}function scoreMultiWordSearch(a,c){if(c.includes(a))return 0;let b=a.indexOf(" ");if(b>-1)while(b>-1){if(before=a.slice(0,b),after=a.slice(b+1,a.length),score1=scoreMultiWordSearch(before,c)-100,score2=scoreMultiWordSearch(after,c)-100,score1!=-(1/0)||score2!=-(1/0))return Math.max(score1,score2);b=a.indexOf(" ",b+1)}return-(1/0)}function filterRecipes(c,a){let b=c;a.q&&(b=c.map(b=>{let d=scoreMultiWordSearch(a.q.toLowerCase(),b.title.toLowerCase()),e=scoreMultiWordSearch(a.q.toLowerCase(),b.body.toLowerCase()),c={...b};if(d>-(1/0))c.searchScore=d;else if(e>-(1/0)){let a=5;c.searchScore=(e-100)*a}return c}).sort((a,b)=>a.searchScore<=b.searchScore?1:-1).filter(a=>a.searchScore>-(1/0)));let d=[];for(let c=0;c<b.length;c++){let e=b[c];if(a.excludeAllergens.some(existsInRecipe(e,"allergens")))continue;if(Object.keys(a.includeTaxonomies).some(b=>a.includeTaxonomies[b].every(negate(existsInRecipe(e,b)))))continue;d.push(e)}return d}function updateRecipeDOM(a){let b="";for(const e in a){let c=a[e],f="."+c.relPermalink,d=c.params.previewimage;b+='<li class="recipe-listing-item col"><a href=".'+f+'">'+'<div class="card h-100 '+(d?"card-image":"")+'" role="article">'+(d?'<img loading="card-img-top lazy" src="'+(d.substr(0,4)=="http"?"":c.relPermalink)+d+'" class="card-image-top mx-1 mt-1" alt="Delicious-looking image of '+escape(c.title)+'" />':"")+'<div class="card-body'+(d?" card-img-overlay":"")+'">'+'<span class="meta">'+escape(c.params.meals)+"/"+escape(c.params.difficulties)+"</span>"+'<h4 class="display-5 mt-lg-3">'+escape(c.title)+"</h4>"+"</div>"+"</div>"+"</a>"+"</li>"}document.getElementById("recipe-listing").innerHTML=b}function onLoad(){let a=decodeFiltersFromURL(document.location);setFiltersToDOM(a),fetch("index.json").then(a=>a.json()).then(b=>{window.recipesData=b;let c=filterRecipes(window.recipesData||[],a);updateRecipeDOM(c),document.getElementById("page-title").innerHTML="Recipes"})}document.addEventListener("DOMContentLoaded",onLoad),document.readyState!=="loading"&&onLoad(),document.getElementById("search-query").addEventListener("input",delay(()=>{let a=getFiltersFromDOM();updateRecipeDOM(filterRecipes(window.recipesData||[],a)),history.pushState(a,document.title,encodeFiltersToURL(a))},400));const checkboxes=document.getElementsByClassName("filter-checkbox");for(let a=0;a<checkboxes.length;a++)checkboxes[a].addEventListener("change",()=>{let a=getFiltersFromDOM();updateRecipeDOM(filterRecipes(window.recipesData||[],a)),history.pushState(a,document.title,encodeFiltersToURL(a))});window.addEventListener("popstate",b=>{let a=b.state;b.state||(a={q:"",excludeAllergens:[],includeTaxonomies:{}}),setFiltersToDOM(a);let c=filterRecipes(window.recipesData||[],a);updateRecipeDOM(c)})